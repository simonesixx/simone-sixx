<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">

  <!-- Responsive mobile (OBLIGATOIRE) -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title id="pageTitle">Produit — Simone Sixx</title>

<link rel="icon" href="assets/images/favicon.png" type="image/png">


  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/style.css">

  <!-- JS -->
  <script src="assets/js/products.js" defer></script>
  <script src="assets/js/shop.js" defer></script>
  <script src="assets/js/newsletter.js" defer></script>

</head>

<body>

<header class="header-mobile">
  <div class="header-mobile">
  <div class="header-mobile-top">

    <!-- MENU BURGER — GAUCHE -->
    <button class="menu-toggle" aria-label="Ouvrir le menu">
      Menu
    </button>

    <!-- LOGO — CENTRE -->
    <div class="header-mobile-logo">
      <a href="index.html">
        <img src="assets/images/logo.png" alt="Simone Sixx">
      </a>
    </div>

    <!-- PANIER — DROITE -->
    <div class="header-mobile-actions">
      <a href="panier.html">
        Panier (<span id="cartCount">0</span>)
    </div>

  </div>

  <!-- MENU DÉROULANT -->
  <nav class="menu-mobile">
    <a href="confections.html">Confections</a>
    <a href="parfums.html">Parfums</a>
    <a href="collection.html">Collections</a>
    <a href="events.html">Évènements</a>

    <div class="menu-secondary">
      <a href="#journal">Journal</a>
    </div>
  </nav>
</div>

</header>

<header>
  <nav class="nav">
    <div class="nav-left">
      <a href="confections.html">Confections</a>
      <a href="parfums.html">Parfums</a>
      <a href="collection.html">Collections</a>
      <a href="events.html">Évènements</a>
    </div>

    <div class="nav-logo">
      <a href="index.html">
        <img src="assets/images/logo.png" class="logo-header" alt="Simone Sixx">
      </a>
    </div>

    <div class="nav-right">
      <a href="#newsletter" class="nav-newsletter">Journal</a>
      <span class="nav-separator"></span>
      <a href="panier.html">
        Panier (<span id="cartCount">0</span>)
      </a>
    </div>


  </nav>
</header>

<main class="product-page">

  <!-- Images produit -->
  <div class="image">
    <div class="images-container" id="imagesContainer">
      <!-- Les images seront générées dynamiquement -->
    </div>
    <div class="carousel-nav mobile-only" id="carouselNav"></div>
  </div>

  <!-- Infos -->
  <div class="info">
    <h1 id="productName"></h1>
    <p class="price" id="productPrice"></p>

    <p class="description" id="productDescription">
    </p>

    <!-- Tailles -->
    <div class="sizes">
  <p>Taille</p>

  <div id="sizesContainer" class="sizes-container">
    <!-- Les tailles seront générées dynamiquement -->
  </div>
</div>


<button class="add-to-cart" onclick="addToCart()">
  Ajouter au panier
</button>

<div class="accordion">

  <div class="accordion-item">
    <button class="accordion-toggle" onclick="toggleAccordion(this)">
      Guide des tailles
    </button>

    <div class="accordion-content">

      <div class="size-table" id="sizeTableContainer">
        <!-- Le tableau sera généré dynamiquement -->
      </div>

    </div>
  </div>

  <div class="accordion-item">
    <button class="accordion-toggle" onclick="toggleAccordion(this)">
      Le mannequin
    </button>

    <div class="accordion-content">
      <p class="mannequin-text" id="mannequinInfo">
        Le mannequin mesure 1m78 et porte une taille Trois.
      </p>
    </div>
  </div>

</div>

</main>

<footer class="site-footer">
  <div class="footer-inner">

    <div class="footer-left">
      <p>© 2026 Simone Sixx</p>
    </div>

    <div class="footer-links">
      <a href="retours.html">Demande de retour</a>
      <a href="legal.html">Pages légales</a>
      <a href="contact.html">Contact</a>
    </div>

  </div>
</footer>

<div class="newsletter-popup" id="newsletterPopup">
  <div class="newsletter-box">

    <button class="newsletter-close" onclick="closeNewsletter()">×</button>

    <h2>Journal Simone Sixx</h2>

    <p>
      Être informé des prochaines pièces,  
      des évènements et publications.
    </p>

 <form id="newsletterForm">
  <input
    type="email"
    placeholder="Adresse e-mail"
    required
  >
  <button type="submit">S’inscrire</button>
</form>

<p class="newsletter-success" hidden>
  Vous êtes inscrit au journal.
</p>

<p class="newsletter-exists" hidden>
  Cette adresse est déjà inscrite.
</p>



  </div>
</div>

<script>
  // Charger le produit au chargement de la page
  document.addEventListener('DOMContentLoaded', function() {
    const productId = getProductIdFromURL();
    const product = getProductById(productId);

    if (product) {
      // Remplir les infos du produit
      document.getElementById('pageTitle').textContent = product.name + ' — Simone Sixx';
      document.getElementById('productName').textContent = product.name;
      document.getElementById('productPrice').textContent = product.price.toFixed(2) + ' EUR';
      document.getElementById('productDescription').textContent = product.description;

      // Générer les images
      const imagesContainer = document.getElementById('imagesContainer');
      imagesContainer.innerHTML = '';
      
      if (product.images && product.images.length > 0) {
        // Sur mobile : carrousel
        if (window.innerWidth <= 768) {
          const carouselContainer = document.createElement('div');
          carouselContainer.className = 'carousel-container';
          carouselContainer.id = 'carouselContainer';
          
          const img = document.createElement('img');
          img.id = 'productImage';
          img.src = 'assets/images/' + product.images[0];
          img.alt = product.name;
          img.className = 'carousel-image';
          
          carouselContainer.appendChild(img);
          imagesContainer.appendChild(carouselContainer);
          
          // Initialiser le carrousel
          if (product.images.length > 1) {
            initCarousel(product);
          }
        } else {
          // Sur desktop : toutes les images en colonne
          product.images.forEach(imgPath => {
            const img = document.createElement('img');
            img.src = 'assets/images/' + imgPath;
            img.alt = product.name;
            img.className = 'desktop-product-image';
            imagesContainer.appendChild(img);
          });
        }
      }

      // Générer les tailles
      const sizesContainer = document.getElementById('sizesContainer');
      sizesContainer.innerHTML = ''; // Vider le conteneur

      product.sizes.forEach(size => {
        const sizeDiv = document.createElement('div');
        sizeDiv.className = 'size';
        sizeDiv.dataset.stock = size.stock;
        sizeDiv.onclick = function() { selectSize(this); };
        sizeDiv.textContent = size.label;
        sizesContainer.appendChild(sizeDiv);
      });

      // Charger le stock depuis localStorage
      loadStockFromLocalStorage(productId);
      updateCartCount();

      // Afficher les infos du mannequin
      if (product.mannequin) {
        document.getElementById('mannequinInfo').textContent = 
          `Le mannequin mesure ${product.mannequin.height} et porte une taille ${product.mannequin.size}.`;
      }

      // Générer le guide des tailles
      generateSizeGuide();

      // Initialiser l'ID du produit pour addToCart
      currentProductId = productId;
    } else {
      alert('Produit non trouvé');
    }
  });

  // Carrousel des images
  let currentImageIndex = 0;

  function initCarousel(product) {
    const carouselNav = document.getElementById('carouselNav');
    const productImage = document.getElementById('productImage');

    // Créer le compteur d'images
    const counter = document.createElement('div');
    counter.className = 'carousel-counter';
    counter.id = 'carouselCounter';
    counter.textContent = `1/${product.images.length}`;
    carouselNav.appendChild(counter);

    // Gestion du swipe mobile
    let touchStartX = 0;
    const carouselContainer = document.getElementById('carouselContainer');

    carouselContainer.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
    });

    carouselContainer.addEventListener('touchend', (e) => {
      const touchEndX = e.changedTouches[0].clientX;
      const diff = touchStartX - touchEndX;

      if (diff > 50) {
        // Swipe vers la gauche → image suivante
        nextSlide(product);
      } else if (diff < -50) {
        // Swipe vers la droite → image précédente
        prevSlide(product);
      }
    });
  }

  function goToSlide(index, product) {
    currentImageIndex = index;
    const productImage = document.getElementById('productImage');
    productImage.src = 'assets/images/' + product.images[index];

    // Mettre à jour le compteur
    const counter = document.getElementById('carouselCounter');
    if (counter) {
      counter.textContent = `${index + 1}/${product.images.length}`;
    }
  }

  function nextSlide(product) {
    currentImageIndex = (currentImageIndex + 1) % product.images.length;
    goToSlide(currentImageIndex, product);
  }

  function prevSlide(product) {
    currentImageIndex = (currentImageIndex - 1 + product.images.length) % product.images.length;
    goToSlide(currentImageIndex, product);
  }

  // Générer le tableau des tailles
  function generateSizeGuide() {
    const productId = getProductIdFromURL();
    const product = getProductById(productId);
    const container = document.getElementById('sizeTableContainer');
    container.innerHTML = '';

    // En-têtes
    const headerRow = document.createElement('div');
    headerRow.className = 'row head';
    headerRow.innerHTML = `
      <span>Taille</span>
      <span>Poitrine</span>
      <span>Taille</span>
      <span>Hanches</span>
    `;
    container.appendChild(headerRow);

    // Linges de données du produit
    if (product && product.sizeGuide) {
      product.sizeGuide.forEach(size => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <span>${size.size}</span>
          <span>${size.poitrine}</span>
          <span>${size.taille}</span>
          <span>${size.hanches}</span>
        `;
        container.appendChild(row);
      });
    }
  };

  // Adapter les fonctions shop.js pour le produit dynamique
  let currentProductId = null;

  function addToCart() {
    if (!selectedSize) {
      alert('Veuillez sélectionner une taille');
      return;
    }

    const currentElement = document.querySelector('.size.selected');
    const stock = parseInt(currentElement.dataset.stock);

    if (stock === 0) {
      alert('Stock indisponible');
      return;
    }

    // Réduire le stock de 1
    const newStock = stock - 1;
    currentElement.dataset.stock = newStock;

    // Sauvegarder en localStorage
    saveStockToLocalStorage(currentProductId);

    // Désactiver si stock = 0
    if (newStock === 0) {
      currentElement.style.opacity = '0.5';
      currentElement.style.cursor = 'not-allowed';
    }

    // Récupérer les infos du produit
    const product = getProductById(currentProductId);

    // Ajouter au panier
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.push({
      productId: currentProductId,
      product: product.name,
      size: selectedSize,
      price: product.price,
      date: new Date().toISOString()
    });

    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();

    alert(`${selectedSize} ajouté au panier. Stock restant: ${newStock}`);
    selectedSize = null;
    currentElement.classList.remove('selected');
  }

  function saveStockToLocalStorage(productId) {
    const stocks = {};
    document.querySelectorAll('.size').forEach(el => {
      const size = el.textContent;
      stocks[size] = parseInt(el.dataset.stock);
    });
    localStorage.setItem(`stock-${productId}`, JSON.stringify(stocks));
  }

  function loadStockFromLocalStorage(productId) {
    const saved = localStorage.getItem(`stock-${productId}`);
    if (saved) {
      const stocks = JSON.parse(saved);
      document.querySelectorAll('.size').forEach(el => {
        const size = el.textContent;
        if (stocks[size] !== undefined) {
          el.dataset.stock = stocks[size];
          if (stocks[size] === 0) {
            el.style.opacity = '0.5';
            el.style.cursor = 'not-allowed';
          }
        }
      });
    }
  }
</script>

</body>
</html>
